!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=101)}({101:function(e,t,r){e.exports=r(102)},102:function(e,t){jQuery((function(e){(function(){var t,r={count:0};function n(e){var t;return t=0,(e=parseInt(e.replace(/[^0-9]/g,"")))>0&&(t=parseInt(5*e/100)),t}function i(t,r){if(void 0===r)return!1;var n=function(t){var r=t.split("?"),n=r[0],i=r[1].split("&"),a={};return e.each(i,(function(e,t){var r=t.split("=");a[r[0]]=r[1]})),{hostName:n,urlArray:a}}(t);return e.each(r,(function(e,t){n.urlArray[e]=t})),function(t,r){var n=t+"?",i=[];return e.each(r,(function(e,t){void 0===t&&(t=""),i.push(e+"="+t)})),n+=i.join("&")}(n.hostName,n.urlArray)}function a(t,r,n,a,c){var s=e("#select_translate").val(),d={rate:e("#min_star").val(),countReviews:e("#count_review").val(),translate:"none"===s?"+N+":"+Y+",ignoreImages:e("#ignoreImages").is(":checked"),withPictures:e("#withImage").is(":checked"),uploadImages:e("#uploadImage").is(":checked"),approved:e("#approved").is(":checked"),skip_keywords:e("#skip_keywords").val(),select_translate:s},l=n?i(n,{translate:d.translate,page:t,withPictures:d.withPictures}):"",f={post_id:r,product_id:a,productUrl:c,page:t,feedbackUrl:n,countReviews:d.countReviews,withPictures:d.withPictures,uploadImages:d.uploadImages,ignoreImages:d.ignoreImages,approved:d.approved,min_star:d.rate,skip_keywords:d.skip_keywords,select_translate:d.select_translate};if(c){var p=[];window.ADS.aliExtension.sendAliExtension("getReviewsProduct",{productid:a,page:t,product_url:c}).then((function(e){var t=e.reviewInfo.reviews;for(var r in t){var n=t[r];p.push({feedback:n.text,flag:n.country.toUpperCase(),author:n.username,star:n.rating,date:o(n.date),images:n.gallery})}u(!1,f,p)}))}else setTimeout((function(){window.ADS.aliExtension.getPage(l).then((function(e){u(e.obj,f,[])}))}),2e3)}function o(e){if(!e.match(/(\d+) (\W+) (\d+) (\d+):(\d+)/im))return e;var t={"янв":"01","фев":"02","мар":"03","апр":"04","май":"05","июн":"06","июл":"07","авг":"08","сен":"09","окт":"10","ноя":"11","дек":"12"},r=e.match(/(\d+) (\W+) (\d+) (\d+):(\d+)/im),n=t.findIndex((function(e){return e===r[2]}));return r[0].replace(r[2],t[n])}function c(){var t=e("#withImage"),r=t.parents(".form-field"),n=e("#uploadImage"),i=n.parents(".form-field");e(document).find("#ignoreImages").is(":checked")?(t.prop("checked")&&t.click(),n.prop("checked")&&n.click(),r.hide(),i.hide()):(r.show(),i.show())}function s(t,r,n){e.ajaxQueue({url:ajaxurl,data:{action:"adsw_action_reviews",ads_action:t,args:r},type:"POST",dataType:"json",success:n})}function u(t,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=i.post_id,c=i.product_id,u=i.productUrl,f=i,p={flag:"",author:"",star:"",feedback:"",date:""},v=[];for(var w in t&&($feedbackList=t.find(".feedback-list-wrap .feedback-item"),$feedbackList.each((function(t,r){var i=[];(p={feedback:"",flag:"",author:"",star:"",date:"",images:[]}).feedback=e(this).find(".buyer-feedback").text(),e(this).find(".buyer-feedback .r-time-new").length&&(p.feedback=e(this).find(".buyer-feedback span:not(.r-time-new)").text()),p.feedback=p.feedback.replace("seller","store"),p.flag=e(this).find(".css_flag").text(),p.author=e(this).find(".user-name").text(),p.star=n(e(this).find(".star-view span").attr("style")),e(this).find(".pic-view-item").each((function(t,r){i.push(e(r).data("src"))}));var o=e(this).find(".r-time");e(this).find(".r-time-new").length&&(o=e(this).find(".r-time-new")),p.date=o.text(),p.images=i,a.push(p)}))),a)v.push(a[w]);if(0!==a.length&&r.count<=f.countReviews){var g={post_id:o,product_id:c,productUrl:u,feed_list:ADS.b64EncodeUnicode(JSON.stringify(v)),star_min:f.star_min,withPictures:f.withPictures,uploadImages:f.uploadImages,ignoreImages:f.ignoreImages,approved:f.approved,importedReview:r.count,page:f.page++,feedbackUrl:f.feedbackUrl,count_review:e("#count_review").val(),select_country:JSON.stringify(f.select_country),skip_keywords:f.skip_keywords,select_translate:f.select_translate};s("upload_review",g,d)}else l()}function d(t){var n=t.post_id,i=t.product_id,o=t.productUrl;r.count+=t.count,r.count<parseInt(e("#count_review").val())&&t.page<30?a(t.page,n,t.feedbackUrl,i,o):l()}function l(){window.ADS.coverHide(),window.ADS.notify(r.count+" "+e(".info-reviews-text").val(),"success"),window.ADS.btnUnLock(e("#js-reviewSingleImport"))}return{init:function(){t||(t=this,e("body").on("click","#js-reviewSingleImport",(function(t){t.preventDefault(),window.ADS.coverShow(),window.ADS.btnLock(e(this));var r=e('[name="post_ID"]').val();(function(t){var r=e("#supplier").val();return"default"===r?window.ADS.product(t,["productUrl"]).then((function(e){if(e){if(e.productUrl)return e.productUrl;window.ADS.notify("There is no link for review. Please update product","danger")}})):Promise.resolve(r)})(r).then((function(e){var t,n=(t=/\/(\d+_)?(\d+)\.html/.exec(e))?t[2]:null;a(1,r,"",n,e)}))})),e("body").on("click","#ignoreImages",(function(){c()})),c())}}})().init()}))}});